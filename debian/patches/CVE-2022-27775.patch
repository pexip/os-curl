From: Markus Koschany <apo@debian.org>
Date: Mon, 25 Jul 2022 12:15:46 +0200
Subject: CVE-2022-27775

Bug-Debian: https://bugs.debian.org/1010253
Origin: https://github.com/curl/curl/commit/058f98dc3fe595f21dc26a5b9b1699e519ba5705
---
 lib/conncache.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/lib/conncache.c b/lib/conncache.c
index cb3170c..41b6100 100644
--- a/lib/conncache.c
+++ b/lib/conncache.c
@@ -159,8 +159,13 @@ static void hashkey(struct connectdata *conn, char *buf,
     /* report back which name we used */
     *hostp = hostname;
 
-  /* put the number first so that the hostname gets cut off if too long */
-  msnprintf(buf, len, "%ld%s", port, hostname);
+  /* put the numbers first so that the hostname gets cut off if too long */
+#ifdef ENABLE_IPV6
+  msnprintf(buf, len, "%u/%ld/%s", conn->scope_id, port, hostname);
+#else
+  msnprintf(buf, len, "%ld/%s", port, hostname);
+#endif
+
 }
 
 /* Returns number of connections currently held in the connection cache.
