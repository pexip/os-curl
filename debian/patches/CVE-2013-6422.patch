From 15006cb1c605d17aa45f8b68b9b58dad9242e37a Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Fri, 29 Nov 2013 22:46:05 +0100
Subject: [PATCH] gtls: respect *VERIFYHOST independently of *VERIFYPEER

Security flaw CVE-2013-6422

This is conceptually the same problem and fix that 3c3622b6 brought to the
OpenSSL backend and that resulted in CVE-2013-4545.

This version of the problem was independently introduced to the GnuTLS
backend with commit 59cf93cc, present in the code since the libcurl
7.21.4 release.

Advisory: http://curl.haxx.se/docs/adv_20131217.html
Bug: http://curl.haxx.se/mail/lib-2013-11/0214.html
Reported-by: Marc Deslauriers
---
 lib/gtls.c | 8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

Index: curl-7.22.0/lib/gtls.c
===================================================================
--- curl-7.22.0.orig/lib/gtls.c	2013-12-17 12:51:45.861700481 -0500
+++ curl-7.22.0/lib/gtls.c	2013-12-17 12:51:45.853700480 -0500
@@ -576,10 +576,8 @@
     else
       infof(data, "\t server certificate verification OK\n");
   }
-  else {
+  else
     infof(data, "\t server certificate verification SKIPPED\n");
-    goto after_server_cert_verification;
-  }
 
   /* initialize an X.509 certificate structure. */
   gnutls_x509_crt_init(&x509_cert);
@@ -709,8 +707,6 @@
 
   gnutls_x509_crt_deinit(x509_cert);
 
-after_server_cert_verification:
-
   /* compression algorithm (if any) */
   ptr = gnutls_compression_get_name(gnutls_compression_get(session));
   /* the *_get_name() says "NULL" if GNUTLS_COMP_NULL is returned */
